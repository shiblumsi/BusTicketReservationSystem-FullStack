<div class="container py-4">
  <!-- ===== Legend ===== -->
  <div class="legend text-center mb-3">
    <span class="me-3"
      ><div class="box available d-inline-block me-1"></div>
      Available</span
    >
    <span class="me-3"
      ><div class="box selected d-inline-block me-1"></div>
      Selected</span
    >
    <span class="me-3"
      ><div class="box booked d-inline-block me-1"></div>
      Booked</span
    >
    <span
      ><div class="box sold d-inline-block me-1"></div>
      Sold</span
    >
  </div>

  <div class="row justify-content-center g-4">
    <!-- ===== Left: Seat Layout ===== -->
    <div class="col-lg-3 col-md-6">
      <div class="seat-layout card shadow-sm p-3">
        <h5 class="text-center fw-bold text-success">
          {{ availableBus.busName }} - {{ availableBus.type }}
        </h5>

        <div class="bus border rounded-3 p-3 text-center">
          <div class="d-flex justify-content-end px-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="40px"
              viewBox="0 -960 960 960"
              width="40px"
              fill="#1f4f1f"
            >
              <path
                d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 31.5-155.5t86-127Q252-817 325-848.5T480-880q83 0 155.5 31.5t127 86q54.5 54.5 86 127T880-480q0 82-31.5 155t-86 127.5q-54.5 54.5-127 86T480-80Zm-30-62v-154q-58-10-99.5-53T296-450H142q10 124 97 210.5T450-142Zm60 0q125-10 211.5-97T818-450H664q-14 58-54.5 101T510-296v154ZM142-510h152l112-118h148l112 118h152q-11-132-108.5-221T480-820q-132 0-229.5 89T142-510Z"
              />
            </svg>
          </div>

          <hr class="border-success opacity-50" />

          <!-- ===== Seat Rows ===== -->
          <div class="text-center">
            <div class="d-flex justify-content-center mb-2" *ngFor="let row of seatRows">
              <div
                class="seat mx-1"
                *ngFor="let seat of row.slice(0, 2)"
                (click)="toggleSeat(seat)"
                [ngClass]="{
                  booked: seat.isBooked,
                  selected: seat.selected,
                  sold: seat.isSold,
                  available: !seat.isBooked && !seat.selected && !seat.isSold
                }"
              >
                {{ seat.seatCode }}
              </div>

              <!-- Aisle (Gap in the middle) -->
              <div class="aisle mx-3"></div>

              <div
                class="seat mx-1"
                *ngFor="let seat of row.slice(2, 4)"
                (click)="toggleSeat(seat)"
                [ngClass]="{
                  booked: seat.isBooked,
                  selected: seat.selected,
                  sold: seat.isSold,
                  available: !seat.isBooked && !seat.selected && !seat.isSold
                }"
              >
                {{ seat.seatCode }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== Right: Booking Summary ===== -->
    <div class="col-lg-4 col-md-6">
      <div class="card shadow-sm p-3">
        <h5 class="text-center text-primary fw-bold mb-1">Booking Summary</h5>
        <hr class="border-success opacity-50" />
        <div class="mb-3">
          <label class="form-label fw-semibold">Boarding Point</label>
          <select
            class="form-select"
            [(ngModel)]="selectedBoardingPoint"
            name="selectedBoardingPoint"
            required
          >
            <option *ngFor="let point of boardingPoints" [value]="point.pointName">
              {{ point.pointName }}
            </option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Dropping Point</label>
          <select
            class="form-select"
            [(ngModel)]="selectedDroppingPoint"
            name="selectedDroppingPoint"
            required
          >
            <option *ngFor="let point of droppingPoints" [value]="point.pointName">
              {{ point.pointName }}
            </option>
          </select>
        </div>

        <ul class="list-group mb-3">
          <li class="list-group-item d-flex justify-content-between">
            <span>Selected Seats:</span>
            <strong If="selectedSeats.length > 0; else noSeats">{{ selectedSeatCode }}</strong>
            <ng-template #noSeats>None</ng-template>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total Seats:</span>
            <strong>{{ selectedSeats.length }}</strong>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total Fare:</span>
            <strong class="text-danger">{{
              selectedSeats.length * availableBus.price | currency : 'BDT '
            }}</strong>
          </li>
        </ul>

        <form (ngSubmit)="bookNow()" #bookingForm="ngForm">
          <div class="mb-3">
            <label class="form-label fw-semibold">Passenger Name</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="passengerName"
              name="passengerName"
              required
            />
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Passenger Mobile</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="passengerMobile"
              name="passengerMobile"
              required
            />
          </div>

          <button
            class="btn btn-danger w-100 fw-semibold"
            type="submit"
            [disabled]="
              selectedSeats.length === 0 ||
              !bookingForm.valid ||
              !selectedBoardingPoint ||
              !selectedDroppingPoint
            "
          >
            Confirm Booking
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
